<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <link rel="stylesheet" href="./file/shop_cart.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
	
    <script src="https://js.tosspayments.com/v1"></script>
    <script src="https://unpkg.com/cart-localstorage@1.1.4/dist/cart-localstorage.min.js" type="text/javascript"></script>
</head>
<body>
	<div class="back"><a onclick="history.go(-1)"><img src="./img/back.png" alt="뒤로가기 링크"></a></div>    
    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
	</div>
	<div class="container">

		<div class="card mb-4 shadow-sm">
			<div class="card-body">
				<table class="table">
					
					<tbody class="cart">
						
					</tbody>
					
					<td><strong class="total"></strong></td>
					
				</table>
			</div>
		</div>
	</div>

	
	<script>
		function renderCart(items) {
			const $cart = document.querySelector(".cart")
			const $total = document.querySelector(".total")

			$cart.innerHTML = items.map((item) => `
					<tr>
						<td>${item.name}</td>
						<td class="text-right">${item.quantity}개</td>
					<tr>
					</tr>
						<br>
						<td>${item.price}원</td>
						<tr><br></tr>
					</tr>
					<tr>
						<td>	
							<button type="button" class="btn btn-block btn-sm btn-outline-primary"
								onClick="alert('${item.name} 총수량 ${item.quantity+1} 개'); cartLS.quantity(${item.id},1)">추가하기</button>
								|
						    <button type="button" class="btn btn-block btn-sm btn-outline-primary"
								onClick="alert('${item.name} 총수량 ${item.quantity-1} 개'); cartLS.quantity(${item.id},-1)">빼기</button>
						</td>
						
						<td><Button class="btn btn-primary" onClick="alert('장바구니에서 삭제되었습니다.');cartLS.remove(${item.id})">장바구니 제외</Button></td>
					<tr><br><hr id="sort"><br></tr>
					</tr>`
					
					).join("")
				
			$total.innerHTML = cartLS.total() + "원"
		}
		renderCart(cartLS.list())
		cartLS.onChange(renderCart)
	</script>

<script type="text/javascript" th:inline="javascript">
	window.addEventListener('load', (event) => {
		document.getElementById("button").addEventListener("click", function () {
			var clientKey = "test_ck_D5GePWvyJnrK0W0k6q8gLzN97Eoq";
			var tossPayments = TossPayments(clientKey);
			tossPayments.requestPayment('카드', {
				amount: cartLS.total(),
				orderId: 'Vcq-l-cQtyDAWxlMgJeI-',
				orderName: "사용자",
				customerName: 'PUBLIC',
				successUrl: 'http://localhost:8080/success',
				failUrl: 'http://localhost:8080/fail',
			})

			/*
			tossPayments.requestBillingAuth("카드", {
				customerKey: "customer_key",
				successUrl: window.location.href + "/success",
				failUrl: window.location.href + "/fail"
			
			});*/
		});
	});
</script>

    
    
    <div class="order_button">
        <center>
            <button class="order" id="button" type="button" style="color: black; background:white; font-size:2em; 
            border-radius:0.5em; padding:5px 20px;" onClick="alert('아직 미완성된 기능입니다.')">주문하기</button>
        </center>
    </div>
	<div class="nav">
	</div>
	<div class="bottom_menu">
		<div id="navimg">
			<img src="./img/Shop.png" alt="매장" onclick="location.href='./index.html';">
		</div>
		<div id="navimg">
			<img src="./img/OnCart.png" alt="장바구니" onclick="location.href='./shop_cart.html';">
		</div>
	</div>
</body>
</html>